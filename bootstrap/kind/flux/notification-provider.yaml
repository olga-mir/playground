---
apiVersion: notification.toolkit.fluxcd.io/v1beta3
kind: Provider
metadata:
  name: github-webhook
  namespace: flux-system
spec:
  type: githubdispatch
  address: https://github.com/olga-mir/playground
  channel: flux-cluster-ready
  secretRef:
    name: github-webhook-token
---
apiVersion: notification.toolkit.fluxcd.io/v1beta3
kind: Alert
metadata:
  name: cluster-ready-alert
  namespace: flux-system
spec:
  providerRef:
    name: github-webhook
  eventSeverity: info
  inclusionList:
    - ".*cluster.*Ready.*"
    - ".*control-plane-cluster.*Ready.*"
  eventSources:
  - kind: Kustomization
    name: crossplane-composite-resources
    namespace: flux-system
  summary: "flux-cluster-ready"
  eventMetadata:
    cluster_name: "{{ if contains .Message \"control-plane\" }}control-plane{{ else if contains .Message \"apps-dev\" }}apps-dev{{ else }}unknown{{ end }}"
    region: "${REGION}"
    project_id: "${PROJECT_ID}"
    cluster_type: "{{ if contains .Message \"control-plane\" }}control-plane{{ else if contains .Message \"apps-dev\" }}apps-dev{{ else }}unknown{{ end }}"
