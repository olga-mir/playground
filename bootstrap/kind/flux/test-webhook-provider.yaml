---
apiVersion: notification.toolkit.fluxcd.io/v1beta3
kind: Provider
metadata:
  name: test-webhook
  namespace: flux-system
spec:
  type: generic
  address: https://webhook.site/b1c2d3e4-f5g6-h7i8-j9k0-l1m2n3o4p5q6
---
apiVersion: notification.toolkit.fluxcd.io/v1beta3
kind: Alert
metadata:
  name: test-cluster-ready-alert
  namespace: flux-system
spec:
  providerRef:
    name: test-webhook
  eventSeverity: info
  eventSources:
  - kind: Kustomization
    name: crossplane-composite-resources
    namespace: flux-system
  eventMetadata:
    cluster_name: "{{ if contains .Object.metadata.name \"control-plane\" }}control-plane{{ else if contains .Object.metadata.name \"apps-dev\" }}apps-dev{{ else }}unknown{{ end }}"
    region: "${REGION}"
    project_id: "${PROJECT_ID}"
    cluster_type: "{{ if contains .Object.metadata.name \"control-plane\" }}control-plane{{ else if contains .Object.metadata.name \"apps-dev\" }}apps-dev{{ else }}unknown{{ end }}"
    message: "Flux cluster ready notification test"